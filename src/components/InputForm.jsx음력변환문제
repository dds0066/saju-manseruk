import React, { useState } from 'react';
import { Calendar, MapPin, Clock, User, Sparkles, Star, Moon, Sun, ArrowRightLeft } from 'lucide-react';

// 음력-양력 변환 컴포넌트
const LunarToSolarConverter = ({ isOpen, onClose, onConvert }) => {
  const [lunarData, setLunarData] = useState({
    year: '',
    month: '',
    day: '',
    hour: '12',
    minute: '0',
    isLeapMonth: false
  });

  const [convertedResult, setConvertedResult] = useState(null);

  // 음력-양력 변환 알고리즘 (개선된 버전)
  const lunarToSolar = (lunarYear, lunarMonth, lunarDay, isLeapMonth = false) => {
    // 년도별 음력 1월 1일의 양력 날짜 (1930년부터 확장)
    const lunarNewYearDates = {
      2030: new Date(2030, 0, 29),   // 2030년 1월 29일
      2029: new Date(2029, 1, 13),   // 2029년 2월 13일
      2028: new Date(2028, 1, 3),    // 2028년 2월 3일
      2027: new Date(2027, 1, 22),   // 2027년 2월 22일
      2026: new Date(2026, 1, 11),   // 2026년 2월 11일
      2025: new Date(2025, 0, 29),   // 2025년 1월 29일
      2024: new Date(2024, 1, 10),   // 2024년 2월 10일
      2023: new Date(2023, 0, 22),   // 2023년 1월 22일
      2022: new Date(2022, 1, 1),    // 2022년 2월 1일
      2021: new Date(2021, 1, 12),   // 2021년 2월 12일
      2020: new Date(2020, 0, 25),   // 2020년 1월 25일
      2019: new Date(2019, 1, 5),    // 2019년 2월 5일
      2018: new Date(2018, 1, 16),   // 2018년 2월 16일
      2017: new Date(2017, 0, 28),   // 2017년 1월 28일
      2016: new Date(2016, 1, 8),    // 2016년 2월 8일
      2015: new Date(2015, 1, 19),   // 2015년 2월 19일
      2014: new Date(2014, 0, 31),   // 2014년 1월 31일
      2013: new Date(2013, 1, 10),   // 2013년 2월 10일
      2012: new Date(2012, 0, 23),   // 2012년 1월 23일
      2011: new Date(2011, 1, 3),    // 2011년 2월 3일
      2010: new Date(2010, 1, 14),   // 2010년 2월 14일
      2009: new Date(2009, 0, 26),   // 2009년 1월 26일
      2008: new Date(2008, 1, 7),    // 2008년 2월 7일
      2007: new Date(2007, 1, 18),   // 2007년 2월 18일
      2006: new Date(2006, 0, 29),   // 2006년 1월 29일
      2005: new Date(2005, 1, 9),    // 2005년 2월 9일
      2004: new Date(2004, 0, 22),   // 2004년 1월 22일
      2003: new Date(2003, 1, 1),    // 2003년 2월 1일
      2002: new Date(2002, 1, 12),   // 2002년 2월 12일
      2001: new Date(2001, 0, 24),   // 2001년 1월 24일
      2000: new Date(2000, 1, 5),    // 2000년 2월 5일
      1999: new Date(1999, 1, 16),   // 1999년 2월 16일
      1998: new Date(1998, 0, 28),   // 1998년 1월 28일
      1997: new Date(1997, 1, 7),    // 1997년 2월 7일
      1996: new Date(1996, 1, 19),   // 1996년 2월 19일
      1995: new Date(1995, 0, 31),   // 1995년 1월 31일
      1994: new Date(1994, 1, 10),   // 1994년 2월 10일
      1993: new Date(1993, 0, 23),   // 1993년 1월 23일
      1992: new Date(1992, 1, 4),    // 1992년 2월 4일
      1991: new Date(1991, 1, 15),   // 1991년 2월 15일
      1990: new Date(1990, 0, 27),   // 1990년 1월 27일
      1989: new Date(1989, 1, 6),    // 1989년 2월 6일
      1988: new Date(1988, 1, 17),   // 1988년 2월 17일
      1987: new Date(1987, 0, 29),   // 1987년 1월 29일
      1986: new Date(1986, 1, 9),    // 1986년 2월 9일
      1985: new Date(1985, 1, 20),   // 1985년 2월 20일
      1984: new Date(1984, 1, 2),    // 1984년 2월 2일
      1983: new Date(1983, 1, 13),   // 1983년 2월 13일
      1982: new Date(1982, 0, 25),   // 1982년 1월 25일
      1981: new Date(1981, 1, 5),    // 1981년 2월 5일
      1980: new Date(1980, 1, 16),   // 1980년 2월 16일
      1979: new Date(1979, 0, 28),   // 1979년 1월 28일
      1978: new Date(1978, 1, 7),    // 1978년 2월 7일
      1977: new Date(1977, 1, 18),   // 1977년 2월 18일
      1976: new Date(1976, 0, 31),   // 1976년 1월 31일
      1975: new Date(1975, 1, 11),   // 1975년 2월 11일
      1974: new Date(1974, 0, 23),   // 1974년 1월 23일
      1973: new Date(1973, 1, 3),    // 1973년 2월 3일
      1972: new Date(1972, 1, 15),   // 1972년 2월 15일
      1971: new Date(1971, 0, 27),   // 1971년 1월 27일
      1970: new Date(1970, 1, 6),    // 1970년 2월 6일
      1969: new Date(1969, 1, 17),   // 1969년 2월 17일
      1968: new Date(1968, 0, 30),   // 1968년 1월 30일
      1967: new Date(1967, 1, 9),    // 1967년 2월 9일
      1966: new Date(1966, 0, 21),   // 1966년 1월 21일
      1965: new Date(1965, 1, 2),    // 1965년 2월 2일
      1964: new Date(1964, 1, 13),   // 1964년 2월 13일
      1963: new Date(1963, 0, 25),   // 1963년 1월 25일
      1962: new Date(1962, 1, 5),    // 1962년 2월 5일
      1961: new Date(1961, 1, 15),   // 1961년 2월 15일
      1960: new Date(1960, 0, 28),   // 1960년 1월 28일
      1959: new Date(1959, 1, 8),    // 1959년 2월 8일
      1958: new Date(1958, 1, 18),   // 1958년 2월 18일
      1957: new Date(1957, 0, 31),   // 1957년 1월 31일
      1956: new Date(1956, 1, 12),   // 1956년 2월 12일
      1955: new Date(1955, 0, 24),   // 1955년 1월 24일
      1954: new Date(1954, 1, 3),    // 1954년 2월 3일
      1953: new Date(1953, 1, 14),   // 1953년 2월 14일
      1952: new Date(1952, 0, 27),   // 1952년 1월 27일
      1951: new Date(1951, 1, 6),    // 1951년 2월 6일
      1950: new Date(1950, 1, 17),   // 1950년 2월 17일
      1949: new Date(1949, 0, 29),   // 1949년 1월 29일
      1948: new Date(1948, 1, 10),   // 1948년 2월 10일
      1947: new Date(1947, 0, 22),   // 1947년 1월 22일
      1946: new Date(1946, 1, 2),    // 1946년 2월 2일
      1945: new Date(1945, 1, 13),   // 1945년 2월 13일
      1944: new Date(1944, 0, 25),   // 1944년 1월 25일
      1943: new Date(1943, 1, 5),    // 1943년 2월 5일
      1942: new Date(1942, 1, 15),   // 1942년 2월 15일
      1941: new Date(1941, 0, 27),   // 1941년 1월 27일
      1940: new Date(1940, 1, 8),    // 1940년 2월 8일
      1939: new Date(1939, 1, 19),   // 1939년 2월 19일
      1938: new Date(1938, 0, 31),   // 1938년 1월 31일
      1937: new Date(1937, 1, 11),   // 1937년 2월 11일
      1936: new Date(1936, 0, 24),   // 1936년 1월 24일
      1935: new Date(1935, 1, 4),    // 1935년 2월 4일
      1934: new Date(1934, 1, 14),   // 1934년 2월 14일
      1933: new Date(1933, 0, 26),   // 1933년 1월 26일
      1932: new Date(1932, 1, 6),    // 1932년 2월 6일
      1931: new Date(1931, 1, 17),   // 1931년 2월 17일
      1930: new Date(1930, 0, 30),   // 1930년 1월 30일
    };

    // 년도별 음력 월별 일수 (윤달 포함)
    const lunarMonthDays = {
      2025: [29, 30, 29, 29, 30, 29, 30, 30, 29, 30, 29, 30], // 10월 윤달
      2024: [29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30],
      2023: [29, 30, 29, 29, 30, 29, 30, 30, 29, 30, 29, 30], // 2월 윤달
      2022: [29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30],
      2021: [29, 30, 29, 29, 30, 29, 30, 30, 29, 30, 29, 30],
      2020: [29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30], // 4월 윤달
      // 기본값: 평년
      default: [29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30]
    };

    const baseDate = lunarNewYearDates[lunarYear];
    const monthDays = lunarMonthDays[lunarYear] || lunarMonthDays.default;

    if (!baseDate) {
      // 기본 계산 (근사치)
      const estimatedBase = new Date(lunarYear, 1, 10);
      let totalDays = 0;
      for (let i = 1; i < lunarMonth; i++) {
        totalDays += monthDays[i - 1] || 29;
      }
      totalDays += lunarDay - 1;

      const resultDate = new Date(estimatedBase);
      resultDate.setDate(estimatedBase.getDate() + totalDays);
      
      return {
        year: resultDate.getFullYear(),
        month: resultDate.getMonth() + 1,
        day: resultDate.getDate(),
        isApproximate: true
      };
    }

    // 정확한 계산
    let totalDays = 0;
    for (let i = 1; i < lunarMonth; i++) {
      totalDays += monthDays[i - 1];
    }
    
    // 윤달 처리
    if (isLeapMonth && lunarMonth > 1) {
      totalDays += 29; // 윤달은 보통 29일
    }
    
    totalDays += lunarDay - 1;

    const resultDate = new Date(baseDate);
    resultDate.setDate(baseDate.getDate() + totalDays);

    return {
      year: resultDate.getFullYear(),
      month: resultDate.getMonth() + 1,
      day: resultDate.getDate(),
      isApproximate: false
    };
  };

  const handleConvert = () => {
    if (!lunarData.year || !lunarData.month || !lunarData.day) {
      alert('음력 년, 월, 일을 모두 입력해주세요.');
      return;
    }

    const year = parseInt(lunarData.year);
    const month = parseInt(lunarData.month);
    const day = parseInt(lunarData.day);
    const hour = parseInt(lunarData.hour);
    const minute = parseInt(lunarData.minute);

    if (year < 1930 || year > 2030) {
      alert('현재 1930년~2030년만 정확한 변환이 가능합니다.');
      return;
    }

    if (month < 1 || month > 12 || day < 1 || day > 30) {
      alert('올바른 음력 날짜를 입력해주세요.');
      return;
    }

    const result = lunarToSolar(year, month, day, lunarData.isLeapMonth);
    const resultWithTime = {
      ...result,
      hour,
      minute,
      originalLunar: { ...lunarData }
    };
    
    setConvertedResult(resultWithTime);
  };

  const handleApply = () => {
    if (convertedResult) {
      onConvert(convertedResult);
      onClose();
    } else {
      alert('변환 결과가 없습니다. 먼저 변환을 실행해주세요.');
    }
  };

  const handleChange = (field, value) => {
    setLunarData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
        {/* 헤더 */}
        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6 rounded-t-2xl">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-xl font-bold flex items-center gap-2">
                <Moon size={24} />
                음력 → 양력 변환기
              </h2>
              <p className="text-white/80 text-sm mt-1">음력 생일을 양력으로 정확히 변환합니다</p>
            </div>
            <button
              onClick={onClose}
              className="p-2 hover:bg-white/20 rounded-lg transition-colors text-2xl"
            >
              ×
            </button>
          </div>
        </div>

        {/* 내용 */}
        <div className="p-6 space-y-6">
          {/* 음력 입력 */}
          <div className="space-y-4">
            <h3 className="font-bold text-gray-800 flex items-center gap-2">
              <Calendar className="text-purple-600" size={18} />
              음력 생년월일시 입력
            </h3>

            {/* 음력 년월일 */}
            <div className="grid grid-cols-3 gap-3">
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">년</label>
                <input
                  type="number"
                  placeholder="1990"
                  value={lunarData.year}
                  onChange={(e) => handleChange('year', e.target.value)}
                  className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                  min="1930"
                  max="2030"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">월</label>
                <input
                  type="number"
                  placeholder="1"
                  value={lunarData.month}
                  onChange={(e) => handleChange('month', e.target.value)}
                  className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                  min="1"
                  max="12"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">일</label>
                <input
                  type="number"
                  placeholder="1"
                  value={lunarData.day}
                  onChange={(e) => handleChange('day', e.target.value)}
                  className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                  min="1"
                  max="30"
                />
              </div>
            </div>

            {/* 윤달 체크박스 */}
            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                id="isLeapMonth"
                checked={lunarData.isLeapMonth}
                onChange={(e) => handleChange('isLeapMonth', e.target.checked)}
                className="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
              />
              <label htmlFor="isLeapMonth" className="text-sm text-gray-700">
                윤달입니다 (예: 윤4월)
              </label>
            </div>

            {/* 음력 시간 */}
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">
                  <Clock size={16} className="inline mr-1" />
                  시
                </label>
                <select
                  value={lunarData.hour}
                  onChange={(e) => handleChange('hour', e.target.value)}
                  className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                >
                  {Array.from({ length: 24 }, (_, i) => (
                    <option key={i} value={i.toString()}>
                      {i.toString().padStart(2, '0')}시
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-600 mb-1">분</label>
                <select
                  value={lunarData.minute}
                  onChange={(e) => handleChange('minute', e.target.value)}
                  className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                >
                  {Array.from({ length: 60 }, (_, i) => (
                    <option key={i} value={i.toString()}>
                      {i.toString().padStart(2, '0')}분
                    </option>
                  ))}
                </select>
              </div>
            </div>
          </div>

          {/* 변환 버튼 */}
          <button
            onClick={handleConvert}
            className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 px-6 rounded-lg font-bold hover:from-purple-700 hover:to-pink-700 transition-all flex items-center justify-center gap-2"
          >
            <ArrowRightLeft size={18} />
            양력으로 변환하기
          </button>

          {/* 변환 결과 */}
          {convertedResult && (
            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
              <h4 className="font-bold text-green-800 mb-3 flex items-center gap-2">
                <Calendar className="text-green-600" size={18} />
                변환 결과 (양력)
              </h4>
              
              <div className="space-y-2 mb-4">
                <div className="bg-white rounded-lg p-3 border border-green-200">
                  <div className="font-bold text-lg text-gray-800">
                    {convertedResult.year}년 {convertedResult.month}월 {convertedResult.day}일
                  </div>
                  <div className="text-gray-600">
                    {convertedResult.hour.toString().padStart(2, '0')}시 {convertedResult.minute.toString().padStart(2, '0')}분
                  </div>
                </div>
                
                <div className="text-xs text-gray-600">
                  <strong>원본 음력:</strong> {convertedResult.originalLunar.year}년 {convertedResult.originalLunar.month}월 {convertedResult.originalLunar.day}일
                  {convertedResult.originalLunar.isLeapMonth && ' (윤달)'}
                </div>
                
                {convertedResult.isApproximate && (
                  <div className="flex items-center gap-2 text-amber-600 bg-amber-50 rounded-lg p-2">
                    <span className="text-xs">
                      ⚠️ 근사치 변환입니다. 1930-2030년 범위에서 더 정확한 변환이 가능합니다.
                    </span>
                  </div>
                )}
              </div>

              <button
                onClick={handleApply}
                className="w-full bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-all"
              >
                ✅ 이 양력 날짜로 사주 보기
              </button>
            </div>
          )}

          {/* 안내사항 */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h5 className="font-bold text-blue-800 mb-2">📋 변환 안내</h5>
            <div className="space-y-1 text-sm text-blue-700">
              <p>• <strong>정확한 변환:</strong> 1930년~2030년 (실제 천문 데이터 기반)</p>
              <p>• <strong>근사치 변환:</strong> 그 외 년도 (1-2일 오차 가능)</p>
              <p>• <strong>윤달:</strong> 음력에서 같은 달이 두 번 있는 경우 체크하세요</p>
              <p>• <strong>시간:</strong> 음력 기준 시간을 입력하면 그대로 양력에 적용됩니다</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export const InputForm = ({ birthInfo, setBirthInfo, onSubmit, cityLongitudes }) => {
  const [focusedField, setFocusedField] = useState(null);
  const [showLunarConverter, setShowLunarConverter] = useState(false);

  const handleChange = (field, value) => {
    setBirthInfo(prev => ({ ...prev, [field]: value }));
  };

  // 음력 변환 결과를 받아서 폼에 적용
  const handleLunarConversion = (convertedData) => {
    setBirthInfo(prev => ({
      ...prev,
      year: convertedData.year.toString(),
      month: convertedData.month.toString(),
      day: convertedData.day.toString(),
      hour: convertedData.hour.toString(),
      minute: convertedData.minute.toString()
    }));
    
    // 변환 성공 알림
    alert(`✅ 양력 ${convertedData.year}년 ${convertedData.month}월 ${convertedData.day}일로 설정되었습니다!`);
  };

  return (
    <>
      <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 relative overflow-hidden">
        {/* 배경 장식 */}
        <div className="absolute inset-0">
          <div className="absolute top-10 left-10 text-yellow-300 opacity-30">
            <Star size={24} className="animate-pulse" />
          </div>
          <div className="absolute top-20 right-20 text-blue-300 opacity-30">
            <Moon size={32} className="animate-bounce" />
          </div>
          <div className="absolute bottom-20 left-20 text-pink-300 opacity-30">
            <Sparkles size={28} className="animate-pulse" />
          </div>
          <div className="absolute bottom-10 right-10 text-orange-300 opacity-30">
            <Sun size={36} className="animate-spin" style={{ animationDuration: '8s' }} />
          </div>
          
          {/* 떠다니는 별들 */}
          {[...Array(20)].map((_, i) => (
            <div
              key={i}
              className="absolute text-yellow-200 opacity-20"
              style={{
                left: `${Math.random() * 100}%`,
                top: `${Math.random() * 100}%`,
                animationDelay: `${Math.random() * 5}s`
              }}
            >
              <Star size={8 + Math.random() * 16} className="animate-pulse" />
            </div>
          ))}
        </div>

        <div className="relative z-10 flex items-center justify-center min-h-screen p-3">
          <div className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl p-6 w-full max-w-2xl border border-white/20">
            {/* 헤더 */}
            <div className="text-center mb-6">
              <div className="flex justify-center items-center gap-2 mb-3">
                <div className="p-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full">
                  <Sparkles className="text-white" size={24} />
                </div>
                <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent">
                  사주만세력
                </h1>
                <div className="p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full">
                  <Star className="text-white" size={24} />
                </div>
              </div>
              <p className="text-gray-600 text-base">✨ 당신의 운명을 정확하게 분석해드립니다 ✨</p>
              <div className="h-1 w-32 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full mx-auto mt-2"></div>
            </div>

            {/* 음력 변환 버튼 */}
            <div className="text-center mb-6">
              <button
                onClick={() => setShowLunarConverter(true)}
                className="bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 px-6 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all flex items-center justify-center gap-2 mx-auto shadow-lg hover:shadow-purple-400/50 transform hover:-translate-y-1"
              >
                <Moon size={20} />
                🌙 음력 → 양력 변환하기
                <ArrowRightLeft size={16} />
              </button>
              <p className="text-gray-500 text-sm mt-2">음력 생일이신가요? 클릭해서 양력으로 변환하세요!</p>
            </div>

            {/* 입력 폼 */}
            <div className="space-y-4">
              {/* 출생 년월일 */}
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-2xl border border-blue-200">
                <h3 className="text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <Calendar className="text-blue-600" size={18} />
                  출생 년월일 (양력)
                </h3>
                <div className="grid grid-cols-3 gap-3">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-1">년도</label>
                    <input
                      type="number"
                      value={birthInfo.year}
                      onChange={(e) => handleChange('year', e.target.value)}
                      onFocus={() => setFocusedField('year')}
                      onBlur={() => setFocusedField(null)}
                      placeholder="1990"
                      min="1900"
                      max="2100"
                      className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                        focusedField === 'year' 
                          ? 'border-purple-500 shadow-lg shadow-purple-200 bg-white' 
                          : 'border-gray-200 bg-white/80'
                      }`}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-1">월</label>
                    <select
                      value={birthInfo.month}
                      onChange={(e) => handleChange('month', e.target.value)}
                      onFocus={() => setFocusedField('month')}
                      onBlur={() => setFocusedField(null)}
                      className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                        focusedField === 'month' 
                          ? 'border-purple-500 shadow-lg shadow-purple-200 bg-white' 
                          : 'border-gray-200 bg-white/80'
                      }`}
                    >
                      <option value="">월 선택</option>
                      {Array.from({length: 12}, (_, i) => (
                        <option key={i + 1} value={i + 1}>{i + 1}월</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-1">일</label>
                    <select
                      value={birthInfo.day}
                      onChange={(e) => handleChange('day', e.target.value)}
                      onFocus={() => setFocusedField('day')}
                      onBlur={() => setFocusedField(null)}
                      className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                        focusedField === 'day' 
                          ? 'border-purple-500 shadow-lg shadow-purple-200 bg-white' 
                          : 'border-gray-200 bg-white/80'
                      }`}
                    >
                      <option value="">일 선택</option>
                      {Array.from({length: 31}, (_, i) => (
                        <option key={i + 1} value={i + 1}>{i + 1}일</option>
                      ))}
                    </select>
                  </div>
                </div>
              </div>

              {/* 출생 시간 & 성별 */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-2xl border border-green-200">
                  <h3 className="text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <Clock className="text-green-600" size={18} />
                    출생 시간
                  </h3>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">시</label>
                      <select
                        value={birthInfo.hour}
                        onChange={(e) => handleChange('hour', e.target.value)}
                        onFocus={() => setFocusedField('hour')}
                        onBlur={() => setFocusedField(null)}
                        className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                          focusedField === 'hour' 
                            ? 'border-green-500 shadow-lg shadow-green-200 bg-white' 
                            : 'border-gray-200 bg-white/80'
                        }`}
                      >
                        <option value="">시 선택</option>
                        {Array.from({length: 24}, (_, i) => (
                          <option key={i} value={i}>{i.toString().padStart(2, '0')}시</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">분</label>
                      <select
                        value={birthInfo.minute}
                        onChange={(e) => handleChange('minute', e.target.value)}
                        onFocus={() => setFocusedField('minute')}
                        onBlur={() => setFocusedField(null)}
                        className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                          focusedField === 'minute' 
                            ? 'border-green-500 shadow-lg shadow-green-200 bg-white' 
                            : 'border-gray-200 bg-white/80'
                        }`}
                      >
                        <option value="0">00분</option>
                        {Array.from({length: 60}, (_, i) => (
                          <option key={i} value={i}>{i.toString().padStart(2, '0')}분</option>
                        ))}
                      </select>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-2xl border border-pink-200">
                  <h3 className="text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <User className="text-pink-600" size={18} />
                    성별
                  </h3>
                  <div className="flex gap-4 justify-center mt-4">
                    <label className="flex items-center cursor-pointer group">
                      <input
                        type="radio"
                        name="gender"
                        value="male"
                        checked={birthInfo.gender === 'male'}
                        onChange={(e) => handleChange('gender', e.target.value)}
                        className="sr-only"
                      />
                      <div className={`w-5 h-5 rounded-full border-2 mr-2 flex items-center justify-center transition-all duration-300 ${
                        birthInfo.gender === 'male' 
                          ? 'border-blue-500 bg-blue-500' 
                          : 'border-gray-300 group-hover:border-blue-400'
                      }`}>
                        {birthInfo.gender === 'male' && (
                          <div className="w-2.5 h-2.5 bg-white rounded-full"></div>
                        )}
                      </div>
                      <span className={`font-medium transition-colors ${
                        birthInfo.gender === 'male' ? 'text-blue-600' : 'text-gray-700'
                      }`}>
                        남성 👨
                      </span>
                    </label>
                    <label className="flex items-center cursor-pointer group">
                      <input
                        type="radio"
                        name="gender"
                        value="female"
                        checked={birthInfo.gender === 'female'}
                        onChange={(e) => handleChange('gender', e.target.value)}
                        className="sr-only"
                      />
                      <div className={`w-5 h-5 rounded-full border-2 mr-2 flex items-center justify-center transition-all duration-300 ${
                        birthInfo.gender === 'female' 
                          ? 'border-pink-500 bg-pink-500' 
                          : 'border-gray-300 group-hover:border-pink-400'
                      }`}>
                        {birthInfo.gender === 'female' && (
                          <div className="w-2.5 h-2.5 bg-white rounded-full"></div>
                        )}
                      </div>
                      <span className={`font-medium transition-colors ${
                        birthInfo.gender === 'female' ? 'text-pink-600' : 'text-gray-700'
                      }`}>
                        여성 👩
                      </span>
                    </label>
                  </div>
                </div>
              </div>

              {/* 출생지 */}
              <div className="bg-gradient-to-r from-orange-50 to-yellow-50 p-4 rounded-2xl border border-orange-200">
                <h3 className="text-base font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <MapPin className="text-orange-600" size={18} />
                  출생지
                  <span className="text-sm text-gray-500 font-normal">(정확한 시간 보정)</span>
                </h3>
                <select
                  value={birthInfo.city}
                  onChange={(e) => handleChange('city', e.target.value)}
                  onFocus={() => setFocusedField('city')}
                  onBlur={() => setFocusedField(null)}
                  className={`w-full px-3 py-2 border-2 rounded-xl transition-all duration-300 ${
                    focusedField === 'city' 
                      ? 'border-orange-500 shadow-lg shadow-orange-200 bg-white' 
                      : 'border-gray-200 bg-white/80'
                  }`}
                >
                  {Object.entries(cityLongitudes).map(([key, city]) => (
                    <option key={key} value={key}>{city.name}</option>
                  ))}
                </select>
              </div>

              {/* 주의사항 */}
              <div className="bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-2xl p-4 shadow-lg">
                <h4 className="font-bold text-amber-800 mb-2 flex items-center gap-2">
                  <Sparkles className="text-amber-600" size={16} />
                  🌟 정확한 분석을 위한 안내사항
                </h4>
                <div className="grid grid-cols-2 gap-2 text-sm text-amber-700">
                  <div className="flex items-start gap-2">
                    <span className="text-amber-500">✨</span>
                    <span>출생 시간은 24시간 기준</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <span className="text-amber-500">🌍</span>
                    <span>출생지별 시간 자동 보정</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <span className="text-amber-500">🎯</span>
                    <span>1분 단위 정밀 분석</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <span className="text-amber-500">📅</span>
                    <span>절기 기준 정확한 사주</span>
                  </div>
                </div>
              </div>

              {/* 제출 버튼 */}
              <div className="relative">
                <button
                  onClick={onSubmit}
                  className="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 text-white py-4 px-6 rounded-2xl font-bold text-lg hover:from-purple-700 hover:via-pink-700 hover:to-blue-700 transition-all duration-300 shadow-2xl hover:shadow-purple-400/50 transform hover:-translate-y-1 hover:scale-105"
                >
                  <div className="flex items-center justify-center gap-3">
                    <Sparkles className="animate-pulse" size={20} />
                    🔮 사주 운명 분석하기 🌟
                    <Star className="animate-spin" size={20} style={{ animationDuration: '3s' }} />
                  </div>
                </button>
                
                {/* 버튼 주변 효과 */}
                <div className="absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 rounded-2xl blur-md opacity-30 -z-10 animate-pulse"></div>
              </div>
            </div>

            {/* 하단 정보 */}
            <div className="mt-4 text-center">
              <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-3 border border-indigo-200">
                <p className="text-indigo-800 font-medium text-sm">🎌 정밀 절기 계산 • 🌏 출생지 경도 보정 • 🔬 과학적 사주 분석</p>
                <div className="flex justify-center items-center gap-2 mt-2">
                  <div className="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                  <div className="w-2 h-2 bg-pink-400 rounded-full animate-pulse" style={{ animationDelay: '0.5s' }}></div>
                  <div className="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style={{ animationDelay: '1s' }}></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* 음력-양력 변환기 모달 */}
      <LunarToSolarConverter
        isOpen={showLunarConverter}
        onClose={() => setShowLunarConverter(false)}
        onConvert={handleLunarConversion}
      />
    </>
  );
};